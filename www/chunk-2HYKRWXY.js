import{A as mt,B as ut,C as G,D as k,E as w,F as H,G as F,H as pt,I as z,J,K as M,L as P,M as gt,N as ht,O as _t,P as V,Q as O,R as $,S as D,a as Ge,b as He,c as Fe,d as ze,e as Je,f as $e,g as Be,h as qe,i as Ue,j as We,k as Ye,l as Ke,m as Qe,n as Xe,o as Ze,p as et,q as tt,r as it,s as nt,t as at,u as ot,v as rt,w as st,x as lt,y as ct,z as dt}from"./chunk-KNQ3R245.js";import{a as je}from"./chunk-2IABKENT.js";import{a as j}from"./chunk-EP5HSTF2.js";import"./chunk-WKCB6FTJ.js";import{$ as ue,A as K,Aa as Le,B as Q,Ba as Te,C as X,Ca as Ne,D as Z,K as R,L as ee,M as te,N as ie,O as E,P as ne,Q as ae,R as oe,S as re,T as se,U as le,V as ce,Y as de,Z as me,aa as pe,ba as ge,ca as he,da as _e,e as C,ea as fe,f,fa as xe,g as x,ga as be,h as U,ha as ve,i as l,ia as Ce,j as W,k as b,ka as ye,l as d,la as we,m as n,ma as Se,n as o,o as p,p as y,pa as Re,q as h,qa as Ee,r as u,ra as Me,s as Y,sa as Pe,t as s,ta as Ie,u as v,ua as ke,v as A,w as L,wa as Oe,x as T,xa as Ae,y as N,ya as Ve,z as I,za as De}from"./chunk-5BTBL3HN.js";import"./chunk-42P5IUVT.js";import"./chunk-XDJGQ7GY.js";import"./chunk-XMO6NZPM.js";import"./chunk-J7VKH6DZ.js";import"./chunk-6F5K652D.js";import"./chunk-SDMJJ4FY.js";import"./chunk-GYLY2RJE.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-4YRHGV2P.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{g}from"./chunk-2R6CW7ES.js";var B=()=>[.25,.5,.6],ft=()=>["OK"];function xt(r,m){if(r&1){let i=y();n(0,"ion-item",21),h("click",function(){let t=f(i).$implicit,a=u(2);return x(a.verConductor(t.id))}),n(1,"ion-text",22),s(2),o(),n(3,"ion-button",23),p(4,"ion-icon",24),o()()}if(r&2){let i=m.$implicit;l(2),v(i.name)}}function bt(r,m){if(r&1){let i=y();n(0,"ion-item",21),h("click",function(){let t=f(i).$implicit,a=u(2);return x(a.verVehiculo(t.id))}),n(1,"ion-text",22),s(2),o(),n(3,"ion-button",23),p(4,"ion-icon",24),o()()}if(r&2){let i=m.$implicit;l(2),v(i.marca)}}function vt(r,m){if(r&1){let i=y();n(0,"div",13)(1,"div",14)(2,"div",15)(3,"ion-text",16),s(4,"Lista de Conductores"),o()(),n(5,"ion-list"),b(6,xt,5,1,"ion-item",17),o()(),n(7,"div",18)(8,"div",15)(9,"ion-text",16),s(10,"Lista de Veh\xEDculos"),o()(),n(11,"ion-list"),b(12,bt,5,1,"ion-item",17),o(),n(13,"div",19)(14,"ion-button",20),h("click",function(){f(i);let t=u();return x(t.abriModalConductor())}),s(15," Agregar Veh\xEDculo "),o()()()()}if(r&2){let i=u();l(6),d("ngForOf",i.conductores),l(6),d("ngForOf",i.vehiculo)}}function Ct(r,m){r&1&&p(0,"ion-spinner")}function yt(r,m){r&1&&p(0,"ion-icon",44)}function wt(r,m){if(r&1){let i=y();n(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),s(3,"JSON de la Ruta"),o(),n(4,"ion-button",45),h("click",function(){f(i);let t=u(2);return x(t.toggleJsonPreview())}),p(5,"ion-icon",46),o()(),n(6,"ion-card-content"),p(7,"ion-textarea",47),o()()}if(r&2){let i=u(2);l(7),d("value",i.getRutaFormateada(i.rutaCompleta))}}function St(r,m){r&1&&(n(0,"div",48),p(1,"ion-spinner"),n(2,"p"),s(3,"Cargando mapa..."),o()())}function Rt(r,m){r&1&&p(0,"ion-spinner")}function Et(r,m){r&1&&p(0,"ion-icon",56)}function Mt(r,m){if(r&1){let i=y();n(0,"ion-item")(1,"ion-label")(2,"h3"),s(3),o()(),n(4,"div",58)(5,"ion-button",59),h("click",function(){let t=f(i).$implicit,a=u(4);return x(a.centrarEnRuta(t))}),p(6,"ion-icon",60),o(),n(7,"ion-button",61),p(8,"ion-icon",62),o()()()}if(r&2){let i=m.$implicit;l(3),v(i.nombre_ruta)}}function Pt(r,m){if(r&1&&(n(0,"div")(1,"ion-list"),b(2,Mt,9,1,"ion-item",57),o()()),r&2){let i=u(3);l(2),d("ngForOf",i.rutasGuardadas)}}function It(r,m){r&1&&(n(0,"p"),s(1,"Crea una ruta y gu\xE1rdala para verla aqu\xED"),o())}function kt(r,m){if(r&1&&(n(0,"ion-item")(1,"ion-label",63)(2,"p"),s(3,"No hay rutas guardadas en el servidor"),o(),b(4,It,2,0,"p",4),o()()),r&2){let i=u(3);l(4),d("ngIf",!i.cargandoRutas)}}function Ot(r,m){if(r&1){let i=y();n(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),s(3,"Rutas Guardadas"),o(),n(4,"ion-buttons",49)(5,"ion-button",20),h("click",function(){f(i);let t=u(2);return x(t.cerrarModalRutas())}),p(6,"ion-icon",46),o()()()(),n(7,"ion-content",50)(8,"ion-card")(9,"ion-card-header")(10,"ion-card-title"),s(11,"\u{1F504} Rutas Guardadas en Servidor"),o()(),n(12,"ion-card-content")(13,"div",51)(14,"ion-button",52),h("click",function(){f(i);let t=u(2);return x(t.cargarRutasGuardadas())}),b(15,Rt,1,0,"ion-spinner",4)(16,Et,1,0,"ion-icon",53),o(),n(17,"ion-button",33),h("click",function(){f(i);let t=u(2);return x(t.toggleRutasGuardadas())}),p(18,"ion-icon",34),o()(),b(19,Pt,3,1,"div",54)(20,kt,5,1,"ng-template",null,0,K),o()(),n(22,"ion-button",55),h("click",function(){f(i);let t=u(2);return x(t.cerrarModalRutas())}),s(23," Cerrar "),o()()}if(r&2){let i=Y(21),e=u(2);l(14),d("disabled",e.cargandoRutas),l(),d("ngIf",e.cargandoRutas),l(),d("ngIf",!e.cargandoRutas),l(),d("color",e.rutasVisibles?"warning":"success"),l(),d("name",e.rutasVisibles?"eye-off":"eye"),l(),d("ngIf",e.rutasGuardadas.length>0)("ngIfElse",i)}}function At(r,m){if(r&1){let i=y();n(0,"div"),p(1,"div",25),n(2,"ion-alert",26),h("didDismiss",function(){f(i);let t=u();return x(t.showAlert=!1)}),o(),n(3,"ion-card",27)(4,"ion-card-header")(5,"ion-card-title"),s(6,"Configuraci\xF3n de Ruta"),o()(),n(7,"ion-card-content")(8,"ion-item")(9,"ion-label",28),s(10,"Nombre de la Ruta"),o(),n(11,"ion-input",29),N("ngModelChange",function(t){f(i);let a=u();return T(a.nombreRuta,t)||(a.nombreRuta=t),x(t)}),h("ionInput",function(){f(i);let t=u();return x(t.actualizarRutaCompleta())}),o()()()(),n(12,"ion-card"),p(13,"ion-card-header",30),n(14,"ion-card-content")(15,"ion-list")(16,"ion-item")(17,"ion-label"),s(18,"Modo Creacion de Rutas"),o(),n(19,"ion-badge",31),s(20),o()()(),n(21,"div",32)(22,"ion-button",33),h("click",function(){f(i);let t=u();return x(t.toggleModoRecorrido())}),p(23,"ion-icon",34),s(24),o(),n(25,"div",35)(26,"ion-button",36),h("click",function(){f(i);let t=u();return x(t.guardarRuta())}),b(27,Ct,1,0,"ion-spinner",4)(28,yt,1,0,"ion-icon",37),s(29),o(),n(30,"ion-button",38),h("click",function(){f(i);let t=u();return x(t.abrirModalRutas())}),p(31,"ion-icon",39),s(32," Mirar rutas "),o(),n(33,"ion-button",40),h("click",function(){f(i);let t=u();return x(t.eliminarRecorrido())}),p(34,"ion-icon",41),s(35," Eliminar "),o()()()()(),b(36,wt,8,1,"ion-card",4)(37,St,4,0,"div",42),n(38,"ion-modal",43),h("didDismiss",function(){f(i);let t=u();return x(t.cerrarModalRutas())}),b(39,Ot,24,7,"ng-template"),o()()}if(r&2){let i=u();l(2),d("isOpen",i.showAlert)("message",i.alertMessage)("buttons",I(17,ft)),l(9),L("ngModel",i.nombreRuta),l(8),d("color",i.modoRecorrido?"success":"medium"),l(),A(" ",i.modoRecorrido?"ACTIVO":"INACTIVO"," "),l(2),d("color",i.modoRecorrido?"danger":"success"),l(),d("name",i.modoRecorrido?"stop":"play"),l(),A(" ",i.modoRecorrido?"Detener creacion de rutas":"Crear Rutas"," "),l(2),d("disabled",!i.rutaCompleta||i.guardandoRuta),l(),d("ngIf",i.guardandoRuta),l(),d("ngIf",!i.guardandoRuta),l(),A(" ",i.guardandoRuta?"Guardando...":"Guardar Ruta"," "),l(4),d("disabled",i.puntosRecorrido.length===0),l(3),d("ngIf",i.showJsonPreview&&i.rutaCompleta),l(),d("ngIf",i.isLoading),l(),d("isOpen",i.modalRutasAbierto)}}function Vt(r,m){if(r&1){let i=y();n(0,"div")(1,"div",64),p(2,"ion-icon",65),o(),n(3,"div",66)(4,"ion-list")(5,"ion-item")(6,"ion-label"),s(7,"Nombre:"),o(),n(8,"ion-text"),s(9),o()(),n(10,"ion-item")(11,"ion-label"),s(12,"Email:"),o(),n(13,"ion-text"),s(14),o()(),n(15,"ion-item")(16,"ion-label"),s(17,"Rol:"),o(),n(18,"ion-text"),s(19),o()()()(),n(20,"div",67)(21,"ion-button",68),h("click",function(){f(i);let t=u();return x(t.logout())}),p(22,"ion-icon",69),s(23," Cerrar Sesi\xF3n "),o()()()}if(r&2){let i=u();l(9),v(i.userData==null?null:i.userData.name),l(5),v(i.userData==null?null:i.userData.email),l(5),v(i.userData==null?null:i.userData.role)}}function Dt(r,m){if(r&1&&(n(0,"ion-select-option",83),s(1),o()),r&2){let i=m.$implicit;d("value",i),l(),v(i)}}function Lt(r,m){if(r&1){let i=y();n(0,"div",70)(1,"div",71),p(2,"div",72),n(3,"h2"),s(4,"Agregar Veh\xEDculos"),o()(),n(5,"form",73),h("ngSubmit",function(){f(i);let t=u();return x(t.registrarVehiculo())}),n(6,"ion-item"),p(7,"ion-input",74),o(),n(8,"ion-item")(9,"ion-select",75)(10,"ion-select-option",76),s(11,"Heil"),o(),n(12,"ion-select-option",77),s(13,"McNeilus"),o(),n(14,"ion-select-option",78),s(15,"Mercedez-Benz"),o()()(),n(16,"ion-item")(17,"ion-select",79),b(18,Dt,2,2,"ion-select-option",80),o()(),n(19,"div",81)(20,"ion-button",82),s(21," Registrar Veh\xEDculo "),o()()()()}if(r&2){let i=u();l(5),d("formGroup",i.vehiculoForm),l(13),d("ngForOf",i.anos)}}function Tt(r,m){if(r&1&&(n(0,"div",70)(1,"div",71)(2,"h2"),s(3,"Conductor"),o()(),n(4,"div",84)(5,"ion-item")(6,"ion-label"),s(7,"Nombre:"),o(),n(8,"ion-text"),s(9),o()(),n(10,"ion-item")(11,"ion-label"),s(12,"Email:"),o(),n(13,"ion-text"),s(14),o()(),n(15,"ion-item")(16,"ion-label"),s(17,"Role:"),o(),n(18,"ion-text"),s(19),o()()()()),r&2){let i=u();l(9),v(i.Perfil==null?null:i.Perfil.name),l(5),v(i.Perfil==null?null:i.Perfil.email),l(5),v(i.Perfil==null?null:i.Perfil.role)}}function Nt(r,m){if(r&1&&(n(0,"div",70)(1,"div",71)(2,"h2"),s(3,"Vehiculo"),o()(),n(4,"div",84)(5,"ion-item")(6,"ion-label"),s(7,"Marca:"),o(),n(8,"ion-text"),s(9),o()(),n(10,"ion-item")(11,"ion-label"),s(12,"Placa:"),o(),n(13,"ion-text"),s(14),o()(),n(15,"ion-item")(16,"ion-label"),s(17,"Modelo:"),o(),n(18,"ion-text"),s(19),o()()()()),r&2){let i=u();l(9),v(i.vehiculoData==null?null:i.vehiculoData.marca),l(5),v(i.vehiculoData==null?null:i.vehiculoData.placa),l(5),v(i.vehiculoData==null?null:i.vehiculoData.modelo)}}var vi=(()=>{let m=class m{constructor(){this.Perfil=null,this.vehiculoData=null,this.modalAbiertoInfo=!1,this.dataSesion=C(j).currentUser,this.selectedTab="map",this.anos=["2019","2020","2021","2022","2023","2024"],this.datos=C(G),this.alertController=C(Oe),this.modalRutasAbierto=!1,this.nav=C(ce),this.authService=C(j),this.alerts=C(je),this.loadingController=C(Ae),this.calleGuardada="",this.data=[],this.currentLocation=null,this.isLoading=!0,this.userName="",this.modalConductor=!1,this.userData=null,this.guardandoRuta=!1,this.CargaDatos=C(G),this.cargandoRutas=!1,this.vehiculoModal=!1,this.isDarkMode=!1,this.rutasVisibles=!0,this.conductores=[],this.modoRecorrido=!1,this.puntosRecorrido=[],this.siguienteId=1,this.showAlert=!1,this.alertMessage="",this.nombreRuta="ruta casa",this.perfilId="75fb749d-1bbc-4b4c-9b65-eedc5204afa5",this.rutaCompleta=null,this.showJsonPreview=!1,this.JSON=JSON,this.rutasGuardadas=[],this.document=C(U),Ge({personRemoveOutline:at,download:Be,copy:Je,trash:mt,close:ze,refresh:rt,locate:Ke,personCircle:it,settings:st,notifications:tt,shieldCheckmark:lt,logOut:Xe,home:Ye,map:Ze,personOutline:nt,ellipsisVertical:qe,add:He,location:Qe,camera:Fe,document:$e,play:ot,stop:ct,wifi:ut,sunny:dt,moon:et,eyeOff:We,eye:Ue})}ngOnInit(){return g(this,null,function*(){yield this.loadMap(),this.cargarRecorridoGuardado(),this.actualizarRutaCompleta(),this.cargarRutasGuardadas(),this.initializeDarkMode(),this.onSegmentChange({detail:{value:this.selectedTab}}),yield this.getConductores(),yield this.obtenerUserSeccion(),yield this.loadUserData(),yield this.obtenerVehiculos(),this.vehiculoForm=new ie({placa:new E("",[R.required]),marca:new E("",[R.required]),modelo:new E("",[R.required]),activo:new E(!0,[R.required]),perfil_id:new E(this.perfilId,[R.required])})})}onSegmentChange(e){e.detail.value==="map"&&setTimeout(()=>{this.loadMap(),this.cargarRutasGuardadas()},300)}abrirModalInfo(){this.modalAbiertoInfo=!0}cerrarModalInfo(){this.modalAbiertoInfo=!1}toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.applyDarkMode(),this.saveDarkModePreference()}applyDarkMode(){this.isDarkMode?this.document.body.classList.add("dark"):this.document.body.classList.remove("dark")}saveDarkModePreference(){localStorage.setItem("darkMode",this.isDarkMode.toString())}initializeDarkMode(){let e=localStorage.getItem("darkMode");e&&(this.isDarkMode=e==="true",this.applyDarkMode())}abriModalConductor(){this.modalConductor=!0}cerraModalConductor(){this.modalConductor=!1}cerrarModalRutas(){this.modalRutasAbierto=!1}vehiculoModalOpen(){this.vehiculoModal=!0}cerrarModalVehiculo(){this.vehiculoModal=!1}loadMap(){return g(this,null,function*(){this.isLoading=!0;try{if((yield k.checkPermissions()).location!=="granted"&&(yield k.requestPermissions()).location!=="granted")throw new Error("Permisos de ubicaci\xF3n denegados");let t=yield k.getCurrentPosition({enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4}),a=t.coords.latitude,c=t.coords.longitude;if(console.log("\u{1F4CD} Ubicaci\xF3n REAL obtenida:",{lat:a,lng:c}),this.currentLocation={lat:a,lng:c},a<-90||a>90||c<-180||c>180)throw new Error("Coordenadas inv\xE1lidas obtenidas");this.initializeMap(c,a)}catch(e){console.error("\u274C Error obteniendo ubicaci\xF3n:",e),console.log("\u{1F5FA}\uFE0F Usando ubicaci\xF3n por defecto: Buenaventura"),this.initializeMap(-77.0797,3.8836)}finally{this.isLoading=!1}})}initializeMap(e,t){this.map&&this.map.setTarget(void 0),console.log("\u{1F5FA}\uFE0F Inicializando mapa en:",{lng:e,lat:t}),this.map=new gt({target:"mapId",layers:[new ht({source:new _t({attributions:[]})})],view:new pt({center:w([e,t]),zoom:15})}),this.markerLayer=new V({source:new D}),this.routeLayer=new V({source:new D,style:new P({stroke:new M({color:"#ff0000",width:4})})}),this.rutasLayer=new V({source:new D,style:new P({stroke:new M({color:"#3880ff",width:3,lineDash:[5,5]})})}),this.map.addLayer(this.markerLayer),this.map.addLayer(this.routeLayer),this.map.addLayer(this.rutasLayer),this.addLocationMarker(e,t),this.map.on("click",a=>g(this,null,function*(){this.modoRecorrido?yield this.agregarPuntoRecorrido(a.coordinate):yield this.obtenerYGuardarCalle(a.coordinate)})),this.dibujarRecorrido()}toggleModoRecorrido(){this.modoRecorrido=!this.modoRecorrido,this.mostrarMensaje(this.modoRecorrido?"Modo recorrido ACTIVADO - Haz clic en el mapa para agregar puntos":"Modo recorrido DESACTIVADO")}agregarPuntoRecorrido(e){return g(this,null,function*(){try{let t=H(e),[a,c]=t,_=yield this.obtenerNombreCalle(c,a),S={id:this.siguienteId++,lat:c,lng:a,calle:_,timestamp:new Date,orden:this.puntosRecorrido.length+1};this.puntosRecorrido.push(S),this.guardarRecorrido(),this.dibujarPuntoRecorrido(S),this.dibujarRecorrido(),this.actualizarRutaCompleta(),this.mostrarMensaje(`Punto ${S.orden} agregado: ${_}`)}catch(t){console.error("Error agregando punto:",t),this.mostrarMensaje("Error al agregar punto")}})}dibujarPuntoRecorrido(e){if(!this.markerLayer)return;let t=new O({geometry:new F(w([e.lng,e.lat]))});t.setStyle(new P({image:new z({radius:6,fill:new J({color:"#ff0000"}),stroke:new M({color:"white",width:2})})})),this.markerLayer.getSource().addFeature(t)}dibujarRecorrido(){if(!this.routeLayer||this.puntosRecorrido.length<2)return;let e=this.puntosRecorrido.sort((c,_)=>c.orden-_.orden).map(c=>w([c.lng,c.lat])),t=new $(e),a=new O({geometry:t});this.routeLayer.getSource().clear(),this.routeLayer.getSource().addFeature(a)}eliminarRecorrido(){this.puntosRecorrido=[],this.siguienteId=1,this.guardarRecorrido(),this.actualizarRutaCompleta(),this.routeLayer&&this.routeLayer.getSource().clear(),this.markerLayer&&this.markerLayer.getSource().clear(),this.currentLocation&&this.addLocationMarker(this.currentLocation.lng,this.currentLocation.lat),this.mostrarMensaje("Recorrido eliminado")}abrirModalRutas(){this.modalRutasAbierto=!0,this.cargarRutasGuardadas()}toggleRutasGuardadas(){this.rutasVisibles=!this.rutasVisibles,this.rutasVisibles?(this.dibujarRutasGuardadas(),this.mostrarMensaje("Rutas mostradas en el mapa")):(this.limpiarRutasGuardadas(),this.mostrarMensaje("Rutas ocultadas del mapa"))}dibujarRutasGuardadas(){if(!this.rutasLayer||!this.rutasGuardadas.length){console.log("\u274C No se pueden dibujar rutas - verificar capa y datos");return}this.limpiarRutasGuardadas(),console.log(`\u{1F3A8} Dibujando ${this.rutasGuardadas.length} rutas organizadamente...`),this.rutasGuardadas.forEach((e,t)=>{this.dibujarRutaOrganizada(e,t)}),console.log("\u2705 Todas las rutas dibujadas organizadamente")}dibujarRutaOrganizada(e,t){try{let a=JSON.parse(e.shape),c=this.obtenerEstiloOrganizado(t);console.log(`\u{1F504} Dibujando ruta ${t+1}: "${e.nombre_ruta}" - Color: ${c.color}`),a.type==="LineString"&&a.coordinates?this.dibujarSegmento(a.coordinates,e.nombre_ruta,c):a.type==="MultiLineString"&&a.coordinates&&a.coordinates.forEach((_,S)=>{this.dibujarSegmento(_,`${e.nombre_ruta}`,c)})}catch(a){console.error("\u274C Error dibujando ruta organizada:",a)}}dibujarSegmento(e,t,a){if(!e||e.length<2){console.log("\u274C Coordenadas insuficientes para dibujar segmento");return}let c=e.map(q=>q.length===2?w(q):w([0,0])),_=new $(c),S=new O({geometry:_,name:t});S.setStyle(new P({stroke:new M({color:a.color,width:a.ancho})})),this.rutasLayer.getSource().addFeature(S)}obtenerEstiloOrganizado(e){let t=["#3880ff","#10dc60","#ffce00","#f04141","#7044ff","#0cd1e8","#ff6b00","#6a1b9a","#004d40","#bf360c"],a=["#4c8dff","#2dd36f","#ffd534","#ff6b6b","#8c7bff","#34e7e7","#ff8c42","#8e24aa","#00796b","#e64a19"],c=e<10?t:a,_=e%c.length;return{color:c[_],ancho:4}}limpiarRutasGuardadas(){this.rutasLayer&&this.rutasLayer.getSource().clear()}centrarEnRuta(e){try{let t=JSON.parse(e.shape);if(t.type==="LineString"&&t.coordinates.length>0){let[a,c]=t.coordinates[0];this.map?.getView().animate({center:w([a,c]),zoom:15,duration:1e3}),this.mostrarMensaje(`Centrado en ruta: ${e.nombre_ruta}`)}}catch(t){console.error("Error centrando en ruta:",t)}}obtenerNumeroPuntos(e){try{let t=JSON.parse(e.shape);return t.type==="LineString"&&t.coordinates?t.coordinates.length:0}catch{return 0}}actualizarRutaCompleta(){if(this.puntosRecorrido.length<2){this.rutaCompleta=null;return}let e={type:"LineString",coordinates:this.puntosRecorrido.sort((t,a)=>t.orden-a.orden).map(t=>[t.lng,t.lat])};this.rutaCompleta={nombre_ruta:this.nombreRuta,perfil_id:this.perfilId,shape:JSON.stringify(e)},console.log("\u{1F504} Ruta actualizada:",this.rutaCompleta)}getShapePreview(){if(!this.rutaCompleta)return"No hay ruta generada";try{return`LineString con ${JSON.parse(this.rutaCompleta.shape).coordinates.length} puntos`}catch{return"Error al parsear shape"}}cargarRutasGuardadas(){return g(this,null,function*(){this.cargandoRutas=!0,console.log("\u{1F504} Iniciando carga de rutas...");try{if(this.rutasGuardadas=yield this.datos.obtenerRutas(),console.log("\u{1F4E6} Rutas recibidas del servidor:",this.rutasGuardadas),!this.rutasGuardadas||this.rutasGuardadas.length===0){console.log("\u2139\uFE0F No hay rutas guardadas en el servidor"),this.mostrarMensaje("No hay rutas guardadas en el servidor");return}let e=this.rutasGuardadas.filter(t=>t&&t.shape&&t.nombre_ruta);if(console.log(`\u2705 ${e.length} rutas v\xE1lidas de ${this.rutasGuardadas.length} totales`),e.length===0){console.log("\u274C No hay rutas v\xE1lidas para mostrar"),this.mostrarMensaje("Las rutas no tienen formato v\xE1lido");return}this.dibujarRutasGuardadas(),console.log("\u{1F389} Rutas cargadas y dibujadas exitosamente")}catch(e){console.error("\u{1F4A5} ERROR en cargarRutasGuardadas:",e);let t="Error desconocido al cargar rutas";e.status===0?t="No se pudo conectar al servidor":e.status===404?t="Servidor no encontrado":e.message&&(t=e.message),this.mostrarAlerta("Error",t)}finally{this.cargandoRutas=!1}})}guardarRuta(){return g(this,null,function*(){if(!this.rutaCompleta){this.mostrarAlerta("Error","No hay ruta para guardar. Agrega al menos 2 puntos al recorrido.");return}if(!this.validarGeoJSON(this.rutaCompleta.shape)){this.mostrarAlerta("Error","El formato de la ruta no es v\xE1lido");return}this.guardandoRuta=!0;try{console.log("\u{1F4BE} Intentando guardar ruta:",this.rutaCompleta);let e=yield this.datos.guardarRuta(this.rutaCompleta);console.log("\u2705 Ruta guardada exitosamente:",e),yield this.cargarRutasGuardadas(),this.mostrarAlerta("\xC9xito",`Ruta "${this.nombreRuta}" guardada correctamente en el servidor`)}catch(e){console.error("\u274C Error detallado al guardar:",e);let t="Error desconocido al guardar la ruta";e.status===0?t="No se pudo conectar al servidor. Verifica tu conexi\xF3n.":e.status===400?t="Datos inv\xE1lidos enviados al servidor":e.status===404?t="Servidor no encontrado (404)":e.status===500?t="Error interno del servidor (500)":e.message&&(t=e.message),yield this.mostrarAlerta("Error al Guardar",t)}finally{this.guardandoRuta=!1}})}validarGeoJSON(e){try{let t=JSON.parse(e);return t.type==="LineString"&&Array.isArray(t.coordinates)&&t.coordinates.length>=2}catch{return!1}}eliminarRuta(e,t){return g(this,null,function*(){try{yield(yield this.alertController.create({header:"Confirmar Eliminaci\xF3n",message:`\xBFEst\xE1s seguro de que quieres eliminar la ruta "${t}"?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",handler:()=>g(this,null,function*(){try{yield this.datos.eliminarRuta(e),this.mostrarMensaje("Ruta eliminada correctamente"),yield this.cargarRutasGuardadas()}catch(c){console.error("Error eliminando ruta:",c),this.mostrarAlerta("Error","No se pudo eliminar la ruta")}})}]})).present()}catch(a){console.error("Error al preparar eliminaci\xF3n:",a)}})}probarConexionServidor(){return g(this,null,function*(){try{this.mostrarAlerta("Probando Conexi\xF3n","Verificando conexi\xF3n con el servidor...");let e=yield this.datos.obtenerRutas();e.length>0?this.mostrarAlerta("Conexi\xF3n Exitosa",`Se encontraron ${e.length} rutas en el servidor. Conexi\xF3n funcionando correctamente.`):this.mostrarAlerta("Conexi\xF3n Exitosa","Conexi\xF3n al servidor exitosa. No hay rutas guardadas a\xFAn.")}catch(e){console.error("Error de conexi\xF3n:",e),this.mostrarAlerta("Error de Conexi\xF3n","No se pudo conectar al servidor. Verifica la URL y que el servidor est\xE9 funcionando.")}})}getRutaFormateada(e){try{let t=JSON.parse(e.shape);return JSON.stringify({perfil_id:e.perfil_id,nombre_ruta:e.nombre_ruta,shape:t},null,2)}catch{return JSON.stringify(e,null,2)}}toggleJsonPreview(){this.showJsonPreview=!this.showJsonPreview}obtenerNombreCalle(e,t){return g(this,null,function*(){try{let c=yield(yield fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&addressdetails=1`)).json();return c&&c.address?this.crearStringCalle(c.address):"Calle no identificada"}catch(a){return console.error("Error obteniendo nombre de calle:",a),"Calle no identificada"}})}guardarRecorrido(){localStorage.setItem("recorridoGuardado",JSON.stringify({puntos:this.puntosRecorrido,siguienteId:this.siguienteId}))}cargarRecorridoGuardado(){try{let e=localStorage.getItem("recorridoGuardado");if(e){let t=JSON.parse(e);this.puntosRecorrido=t.puntos||[],this.siguienteId=t.siguienteId||1,this.puntosRecorrido.length>0&&setTimeout(()=>{this.dibujarRecorrido(),this.puntosRecorrido.forEach(a=>this.dibujarPuntoRecorrido(a)),this.actualizarRutaCompleta()},1e3)}}catch(e){console.error("Error cargando recorrido guardado:",e)}}mostrarMensaje(e){this.alertMessage=e,this.showAlert=!0,setTimeout(()=>this.showAlert=!1,3e3)}addLocationMarker(e,t){if(!(!this.map||!this.markerLayer)&&(!this.modoRecorrido||this.puntosRecorrido.length===0)){let a=new O({geometry:new F(w([e,t]))});a.setStyle(new P({image:new z({radius:8,fill:new J({color:"#3880ff"}),stroke:new M({color:"white",width:2})})})),this.markerLayer.getSource().addFeature(a)}}obtenerYGuardarCalle(e){return g(this,null,function*(){try{let t=H(e),[a,c]=t,_=yield this.obtenerNombreCalle(c,a);this.guardarCalle(_,e)}catch(t){console.error("Error:",t)}})}crearStringCalle(e){let t=[e.road,e.street,e.pedestrian,e.footway].filter(c=>c&&c.match(/\d+/));if(t.length>0)return`Calle ${t[0].match(/(\d+)/)[1]}`;let a=e.road||e.street||e.pedestrian;if(a){let c=a.match(/(\d+)/);return c?`Calle ${c[1]}`:`Calle ${a}`}return"Calle no identificada"}guardarCalle(e,t){this.calleGuardada=e,localStorage.setItem("ultimaCalleCapturada",e),console.log("Calle guardada:",e),this.mostrarCalleGuardada(e,t)}mostrarCalleGuardada(e,t){this.mostrarMensaje(`Calle guardada: ${e}`)}buscar(){return g(this,null,function*(){if(!this.calleGuardada){console.log("No hay calle guardada para buscar");return}console.log("Buscando calle:",this.calleGuardada);let e=yield this.datos.buscarCallePorNombre(this.calleGuardada);console.log("Resultados de b\xFAsqueda:",e)})}centrarEnUbicacionActual(){return g(this,null,function*(){try{let e=yield k.getCurrentPosition({enableHighAccuracy:!0}),t=e.coords.latitude,a=e.coords.longitude;this.map?.getView().animate({center:w([a,t]),zoom:15,duration:1e3}),this.addLocationMarker(a,t),this.mostrarMensaje("Mapa centrado en tu ubicaci\xF3n actual")}catch(e){console.error("Error centrando en ubicaci\xF3n actual:",e),this.mostrarMensaje("Error al obtener la ubicaci\xF3n actual")}})}mostrarAlerta(e,t){return g(this,null,function*(){yield(yield this.alertController.create({header:e,message:t,buttons:["OK"]})).present()})}getConductores(){return g(this,null,function*(){this.conductores=yield this.authService.getAllConductores()})}verConductor(e){return g(this,null,function*(){this.Perfil=yield this.authService.getProfileById(e),this.abrirModalInfo()})}logout(){return g(this,null,function*(){yield(yield this.alertController.create({header:"Cerrar sesi\xF3n",message:"\xBFEst\xE1s seguro que deseas cerrar sesi\xF3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Cerrar sesi\xF3n",handler:()=>{g(this,null,function*(){this.isLoading=!0;try{yield this.authService.logout(),localStorage.removeItem("token"),localStorage.removeItem("user");try{this.markerLayer?.getSource()?.clear?.(),this.routeLayer?.getSource()?.clear?.(),this.rutasLayer?.getSource()?.clear?.(),this.map&&(this.map.setTarget(void 0),this.map=void 0)}catch(t){console.warn("Error limpiando mapa durante logout:",t)}yield this.nav.navigateRoot("/login")}catch(t){console.error("Error al cerrar sesi\xF3n:",t),yield this.mostrarAlerta("Error","No se pudo cerrar sesi\xF3n. Intenta de nuevo.")}finally{this.isLoading=!1}})}}]})).present()})}loadUserData(){return g(this,null,function*(){this.userName=yield this.authService.getUserName()})}registrarVehiculo(){return g(this,null,function*(){let e=this.vehiculoForm.value;if(this.vehiculoForm.invalid){this.alerts.DataIncorreta();return}let t=yield this.loadingController.create({message:"Registrando Veh\xEDculo..."});yield t.present();try{yield this.CargaDatos.registrarVehiculo(e),yield t.dismiss(),this.vehiculoForm.reset(),this.obtenerVehiculos(),console.log("Veh\xEDculo registrado con \xE9xito",e)}catch(a){yield t.dismiss(),console.error("Error registrando veh\xEDculo:",a)}})}obtenerVehiculos(){return g(this,null,function*(){this.vehiculo=yield this.CargaDatos.obtenerVehiculos(),console.log("Veh\xEDculos Disponibles",this.vehiculo)})}verVehiculo(e){return g(this,null,function*(){this.vehiculoData=yield this.CargaDatos.obtenerVehiculoPorId(e),this.vehiculoModalOpen()})}obtenerUserSeccion(){return g(this,null,function*(){this.userData=yield this.authService.getCurrentUserData()})}};m.\u0275fac=function(t){return new(t||m)},m.\u0275cmp=W({type:m,selectors:[["app-home-conductor"]],decls:28,vars:18,consts:[["sinRutas",""],[3,"translucent"],["scrollY","false",3,"fullscreen"],["class","map",4,"ngIf"],[4,"ngIf"],[1,"custom-modal",3,"didDismiss","isOpen","initialBreakpoint","breakpoints"],[3,"ngModelChange","ionChange","ngModel"],["value","home"],["name","home"],["value","map"],["name","map"],["value","perfil"],["name","person-outline"],[1,"map"],[1,"conductores"],[1,"conductor-title"],[2,"font-size","22px"],["button","true","class","info",3,"click",4,"ngFor","ngForOf"],[1,"vehiculos"],[1,"add"],[3,"click"],["button","true",1,"info",3,"click"],[1,"name-conductor"],["size","large","slot","end","fill","clear","color","danger"],["name","person-remove-outline"],["id","mapId",2,"height","50vh","width","100%"],[3,"didDismiss","isOpen","message","buttons"],[1,"config-rutas"],["position","stacked"],["placeholder","Ej: Ruta Casa-Trabajo",3,"ngModelChange","ionInput","ngModel"],[1,"header-ges"],[3,"color"],[2,"display","flex","flex-direction","column","gap","10px","margin-top","15px"],["expand","block",3,"click","color"],["slot","start",3,"name"],[2,"display","flex","gap","10px"],["expand","block","color","primary",3,"click","disabled"],["slot","start","name","download",4,"ngIf"],["expand","block","color","secondary",3,"click"],["slot","start","name","copy"],["expand","block","color","danger",3,"click","disabled"],["slot","start","name","trash"],["class","loading-spinner",4,"ngIf"],[3,"didDismiss","isOpen"],["slot","start","name","download"],["fill","clear",3,"click"],["slot","icon-only","name","close"],["rows","10","readonly","",2,"font-family","monospace","font-size","12px",3,"value"],[1,"loading-spinner"],["slot","end"],[1,"ion-padding"],[2,"display","flex","justify-content","space-between","margin","8%"],["expand","block","color","secondary",3,"click","disabled"],["slot","start","name","refresh",4,"ngIf"],[4,"ngIf","ngIfElse"],["expand","block","color","medium",2,"margin-top","20px",3,"click"],["slot","start","name","refresh"],[4,"ngFor","ngForOf"],["slot","end",2,"display","flex","gap","5px"],["color","primary","size","small",3,"click"],["name","locate"],["color","danger","size","small"],["name","trash"],[1,"ion-text-center"],[1,"logoUser"],["name","person-circle","size","large",1,"icon"],[1,"infoPerfil"],[1,"btnlogout-section"],["color","danger","expand","block","fill","outline",1,"buttonIni",3,"click"],["slot","start","name","log-out"],[1,"modal-container"],[1,"modal-header"],[1,"modal-handle"],[1,"info",3,"ngSubmit","formGroup"],["placeholder","Placa","type","text","formControlName","placa"],["aria-label","Fruit","interface","popover","placeholder","Selecciona Marca","formControlName","marca"],["value","Heil"],["value","McNeilus"],["value","Mercedez-Benz"],["aria-label","A\xF1o","interface","popover","placeholder","Selecciona modelo","formControlName","modelo"],[3,"value",4,"ngFor","ngForOf"],[1,"btn"],["color","success","type","submit","expand","block",1,"buttonIni"],[3,"value"],[1,"info"]],template:function(t,a){t&1&&(p(0,"ion-header",1),n(1,"ion-content",2),b(2,vt,16,2,"div",3)(3,At,40,18,"div",4)(4,Vt,24,3,"div",4),n(5,"ion-modal",5),h("didDismiss",function(){return a.cerraModalConductor()}),b(6,Lt,22,2,"ng-template"),o(),n(7,"ion-modal",5),h("didDismiss",function(){return a.cerrarModalInfo()}),s(8,"> "),b(9,Tt,20,3,"ng-template"),o(),n(10,"ion-modal",5),h("didDismiss",function(){return a.cerrarModalVehiculo()}),s(11,"> "),b(12,Nt,20,3,"ng-template"),o()(),n(13,"ion-footer")(14,"ion-toolbar")(15,"ion-segment",6),N("ngModelChange",function(_){return T(a.selectedTab,_)||(a.selectedTab=_),_}),h("ionChange",function(_){return a.onSegmentChange(_)}),n(16,"ion-segment-button",7),p(17,"ion-icon",8),n(18,"ion-label"),s(19,"Inicio"),o()(),n(20,"ion-segment-button",9),p(21,"ion-icon",10),n(22,"ion-label"),s(23,"Mapa"),o()(),n(24,"ion-segment-button",11),p(25,"ion-icon",12),n(26,"ion-label"),s(27,"Perfil"),o()()()()()),t&2&&(d("translucent",!0),l(),d("fullscreen",!0),l(),d("ngIf",a.selectedTab==="home"),l(),d("ngIf",a.selectedTab==="map"),l(),d("ngIf",a.selectedTab==="perfil"),l(),d("isOpen",a.modalConductor)("initialBreakpoint",.6)("breakpoints",I(15,B)),l(2),d("isOpen",a.modalAbiertoInfo)("initialBreakpoint",.6)("breakpoints",I(16,B)),l(3),d("isOpen",a.vehiculoModal)("initialBreakpoint",.6)("breakpoints",I(17,B)),l(5),L("ngModel",a.selectedTab))},dependencies:[Te,De,ve,de,ge,pe,be,Ce,Ie,ke,he,_e,fe,xe,Se,ye,we,ue,me,Ne,Me,Z,Q,X,se,ae,ee,te,ne,Ve,Le,Re,Pe,Ee,le,oe,re],styles:['@charset "UTF-8";.loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center}.loading-spinner[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:10px}.find[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.find[_ngcontent-%COMP%]   .find-icon[_ngcontent-%COMP%]{font-size:24px}ion-button[slot=end][_ngcontent-%COMP%]{--color: var(--ion-text-color)}body[_ngcontent-%COMP%], ion-card[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%], ion-toolbar[_ngcontent-%COMP%]{transition:background-color .3s ease,color .3s ease}ion-item[_ngcontent-%COMP%]{--border-radius: 8px;margin-bottom:8px}ion-card[_ngcontent-%COMP%]{margin:10px;box-shadow:0 2px 8px #0000001a}ion-card-header[_ngcontent-%COMP%]{padding-bottom:0}ion-card-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1.1em;font-weight:600}ion-badge[_ngcontent-%COMP%]{font-size:.8em;font-weight:600}ion-textarea[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:8px;--padding-start: 12px;--padding-end: 12px}ion-button[_ngcontent-%COMP%]{--border-radius: 8px}@media (max-width: 768px){.loading-spinner[_ngcontent-%COMP%]{padding:15px}.loading-spinner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}ion-card[_ngcontent-%COMP%]{margin:8px}}ion-button[disabled][_ngcontent-%COMP%]{opacity:.6}.conductores[_ngcontent-%COMP%]{margin:0 auto;width:80%;padding-top:8%;height:50vh}.vehiculos[_ngcontent-%COMP%]{margin:0 auto;width:80%}.conductor-title[_ngcontent-%COMP%]{display:flex;justify-content:center}.add[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.custom-modal[_ngcontent-%COMP%]{--border-radius: 16px 16px 0 0}.modal-handle[_ngcontent-%COMP%]{width:40px;height:4px;background:var(--ion-color-medium);border-radius:2px;margin:8px auto}.modal-container[_ngcontent-%COMP%]{padding:16px}.modal-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:16px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:8px 0 0;color:var(--ion-color-dark)}.infoPerfil[_ngcontent-%COMP%]{padding-top:8%;margin-left:4%;margin-right:4%}ion-content[_ngcontent-%COMP%]{height:100vh}.logoUser[_ngcontent-%COMP%]{padding-top:15%;display:flex;width:100%;height:auto}.icon[_ngcontent-%COMP%]{display:flex;margin:auto;width:200px;height:200px}.btnlogout-section[_ngcontent-%COMP%]{padding:20px;margin-top:auto}']});let r=m;return r})();export{vi as HomeAdminPage};
